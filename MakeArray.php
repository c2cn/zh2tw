<?php/** * 制作转换用数组 *  * 说明： * 从指定的目录里读取文件，并按照指定的规则取出字符串，并将取出的字符串制作成数组写入文件。 *  * @author 宋健 * @version 0.1, 2012-1-30 */set_time_limit(0);date_default_timezone_set('PRC');header("Content-type: text/html; charset=utf-8");$dir_path = 'D:\新建文件夹'; //需要取的文件目录$suffix = array('php','html','css','txt'); //需要取的文件类型$file_charset = ''; //导入文件的文件编码，留空为UTF-8$pattern = '\d你\d'; //取字符串的规则，使用正则表达式$output_file_path = ''; //输出文件路径$dir_path = iconv('UTF-8','GBK',$dir_path);directory_traversal($dir_path,$suffix,$pattern,$file_charset);/** * 转换一个文件 *  * @access global * @param mixed $file 文件路径 * @param mixed $new_needle 转换的数组 * @param mixed $file_charset 导入文件编码 * @return void */function conversion_one_file($file,$pattern,$file_charset){    $input = !empty($file_charset)?iconv($file_charset,'UTF-8',file_get_contents($file)):file_get_contents($file);    preg_match($pattern, $input, $matches);    echo '<pre>';    print_r($matches);    echo '</pre>';    exit;}/** * 遍历目录 *  * @access global * @param mixed $dir_p 目录地址 * @param mixed $new_needle 转换的数组 * @param mixed $file_charset 导入文件编码 * @return void */function directory_traversal($dir_p,$suffix,$pattern,$file_charset){    $dir_p .= '\\';    $dir = opendir($dir_p);    readdir($dir);readdir($dir);    while(($item = readdir($dir)) !== false) {        $item = $dir_p.$item;        if(is_file($item)){            $file = & $item;            $file_info = pathinfo($file);            if(in_array($file_info['extension'],$suffix)) {                conversion_one_file($file,$pattern,$file_charset);            }        }else if(is_dir($item)){            directory_traversal($item,$suffix,$pattern,$file_charset);        }    }    closedir($dir);}